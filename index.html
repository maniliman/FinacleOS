<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FinanceOS v6.5</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #05070a;
            color: #f9fafb;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            padding: 20px;
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
        }

        h1 {
            color: #c5a059;
            margin-bottom: 20px;
        }

        .card {
            background: #0f1218;
            border: 1px solid #1f2937;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .balance {
            font-size: 32px;
            color: #c5a059;
            font-weight: bold;
            margin: 10px 0;
        }

        input, select {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            background: #1f2937;
            border: 1px solid #374151;
            border-radius: 8px;
            color: #f9fafb;
        }

        button {
            width: 100%;
            padding: 12px;
            background: #c5a059;
            color: #05070a;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            margin-bottom: 10px;
        }

        button:hover {
            background: #a68243;
        }

        .transaction {
            background: #1f2937;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
        }

        .transaction-amount {
            font-weight: bold;
            color: #c5a059;
        }

        .delete-btn {
            background: #ef4444;
            color: white;
            width: auto;
            padding: 5px 10px;
            margin: 0 0 0 10px;
        }

        .delete-btn:hover {
            background: #dc2626;
        }

        .search-input {
            margin-bottom: 20px;
        }

        .filters {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .filter-btn {
            flex: 1;
            padding: 8px;
            background: #1f2937;
            color: #9ca3af;
            border: 1px solid #374151;
            cursor: pointer;
            border-radius: 6px;
        }

        .filter-btn.active {
            background: #c5a059;
            color: #05070a;
        }

        .pin-input {
            font-size: 24px;
            letter-spacing: 10px;
        }

        .pin-keypad {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .pin-key {
            padding: 20px;
            font-size: 18px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="pinscreen"></div>
        <div id="app" style="display:none;"></div>
    </div>

    <script>
        const save = (key, value) => localStorage.setItem(key, JSON.stringify(value));
        const load = (key) => {
            try {
                return JSON.parse(localStorage.getItem(key));
            } catch {
                return null;
            }
        };

        let pin = load('fin_pin');
        let authenticated = false;
        let currentPin = '';
        let transactions = load('fin_trans') || [];
        let filter = 'all';
        let search = '';

        const accounts = [
            { name: 'Primary Checking', balance: 125000 },
            { name: 'Savings', balance: 450000 },
            { name: 'Investments', balance: 2100000 }
        ];

        const getTotalBalance = () => accounts.reduce((sum, a) => sum + a.balance, 0);

        const categorize = (title) => {
            const t = title.toLowerCase();
            if (/salary|income|bonus/.test(t)) return 'üèõÔ∏è Landmark';
            if (/shop|store|buy/.test(t)) return 'üõçÔ∏è Shopping';
            if (/food|eat|coffee|lunch/.test(t)) return '‚òï Dining';
            return 'üìù Other';
        };

        const showPin = () => {
            const html = `
                <div class="card">
                    <h1>üîê FinanceOS</h1>
                    <p style="color: #9ca3af; margin-bottom: 20px;">${!pin ? 'Create a 4-digit PIN' : 'Enter your PIN'}</p>
                    <input type="text" class="pin-input" id="pinDisplay" value="${currentPin.replace(/./g, '‚óè')}" readonly>
                    <div class="pin-keypad">
                        ${[1,2,3,4,5,6,7,8,9].map(n => `<button class="pin-key" onclick="addPin(${n})">${n}</button>`).join('')}
                        <button class="pin-key" onclick="delPin()">DEL</button>
                        <button class="pin-key" onclick="addPin(0)">0</button>
                    </div>
                    <button onclick="submitPin()">${!pin ? 'Create PIN' : 'Unlock'}</button>
                </div>
            `;
            document.getElementById('pinscreen').innerHTML = html;
        };

        window.addPin = (num) => {
            if (currentPin.length < 4) {
                currentPin += num;
                showPin();
            }
        };

        window.delPin = () => {
            currentPin = currentPin.slice(0, -1);
            showPin();
        };

        window.submitPin = () => {
            if (currentPin.length !== 4) {
                alert('PIN must be 4 digits');
                return;
            }
            if (!pin) {
                pin = currentPin;
                save('fin_pin', pin);
                alert('PIN created! Now enter it again to unlock.');
                currentPin = '';
                showPin();
            } else if (currentPin === pin) {
                authenticated = true;
                currentPin = '';
                document.getElementById('pinscreen').innerHTML = '';
                document.getElementById('app').style.display = 'block';
                showApp();
            } else {
                alert('Wrong PIN');
                currentPin = '';
                showPin();
            }
        };

        const showApp = () => {
            const balance = getTotalBalance();
            const filtered = transactions
                .filter(t => !search || t.title.toLowerCase().includes(search.toLowerCase()))
                .filter(t => filter === 'all' || t.type === filter);

            const inflow = transactions.filter(t => t.type === 'in').reduce((s, t) => s + t.amount, 0);
            const outflow = transactions.filter(t => t.type === 'out').reduce((s, t) => s + t.amount, 0);
            const liquidity = inflow === 0 ? 0 : Math.round((inflow - outflow) / inflow * 100);

            const html = `
                <h1>üí∞ FinanceOS v6.5</h1>
                
                <div class="card">
                    <div style="font-size: 12px; color: #9ca3af;">NET WORTH</div>
                    <div class="balance">‚Ç¶${balance.toLocaleString()}</div>
                    <div style="font-size: 12px; color: #9ca3af;">Liquidity: <span style="color: #c5a059;">${liquidity}%</span></div>
                </div>

                <div class="card">
                    <h3 style="margin-bottom: 10px;">Accounts</h3>
                    ${accounts.map(a => `
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span>${a.name}</span>
                            <span style="color: #c5a059;">‚Ç¶${a.balance.toLocaleString()}</span>
                        </div>
                    `).join('')}
                </div>

                <div class="card">
                    <h3 style="margin-bottom: 15px;">Add Transaction</h3>
                    <input type="text" id="txTitle" placeholder="Title (e.g., Salary, Coffee)">
                    <select id="txType">
                        <option value="out">üì§ Spend</option>
                        <option value="in">üì• Income</option>
                    </select>
                    <input type="number" id="txAmount" placeholder="Amount" value="50000">
                    <input type="text" id="txMemo" placeholder="Memo (optional)">
                    <button onclick="addTx()">‚úì Record Transaction</button>
                </div>

                <input type="text" class="search-input" id="search" placeholder="Search..." onkeyup="updateSearch(this.value)">
                
                <div class="filters">
                    <button class="filter-btn ${filter === 'all' ? 'active' : ''}" onclick="setFilter('all')">All</button>
                    <button class="filter-btn ${filter === 'in' ? 'active' : ''}" onclick="setFilter('in')">üì• In</button>
                    <button class="filter-btn ${filter === 'out' ? 'active' : ''}" onclick="setFilter('out')">üì§ Out</button>
                </div>

                <div class="card">
                    <h3 style="margin-bottom: 10px;">Transactions (${filtered.length})</h3>
                    ${filtered.length === 0 ? '<p style="color: #9ca3af; text-align: center;">No transactions yet</p>' : ''}
                    ${filtered.map(t => `
                        <div class="transaction">
                            <div style="flex: 1;">
                                <div>${t.icon} ${t.title}</div>
                                <div style="font-size: 11px; color: #9ca3af;">${t.date}</div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <span class="transaction-amount">${t.type === 'in' ? '+' : '-'}‚Ç¶${t.amount.toLocaleString()}</span>
                                <button class="delete-btn" onclick="delTx(${t.id})">‚úï</button>
                            </div>
                        </div>
                    `).join('')}
                </div>

                <button onclick="exportData()" style="background: #6b7280;">üíæ Export</button>
                <button onclick="logout()" style="background: #6b7280;">üö™ Logout</button>
                <button onclick="resetAll()" style="background: #ef4444;">‚ö†Ô∏è Reset</button>
            `;
            document.getElementById('app').innerHTML = html;
        };

        window.addTx = () => {
            const title = document.getElementById('txTitle').value;
            const type = document.getElementById('txType').value;
            const amount = parseInt(document.getElementById('txAmount').value) || 0;
            const memo = document.getElementById('txMemo').value;

            if (!title) {
                alert('Enter a title');
                return;
            }

            const tx = {
                id: Date.now(),
                title,
                type,
                amount,
                memo,
                icon: categorize(title),
                date: new Date().toLocaleDateString()
            };

            transactions.unshift(tx);
            save('fin_trans', transactions);
            document.getElementById('txTitle').value = '';
            document.getElementById('txAmount').value = '50000';
            document.getElementById('txMemo').value = '';
            showApp();
        };

        window.delTx = (id) => {
            if (confirm('Delete this transaction?')) {
                transactions = transactions.filter(t => t.id !== id);
                save('fin_trans', transactions);
                showApp();
            }
        };

        window.setFilter = (f) => {
            filter = f;
            showApp();
        };

        window.updateSearch = (q) => {
            search = q;
            showApp();
        };

        window.exportData = () => {
            const data = { accounts, transactions, date: new Date().toISOString() };
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `FinanceOS_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
        };

        window.resetAll = () => {
            if (confirm('Delete ALL data? This cannot be undone.')) {
                localStorage.clear();
                location.reload();
            }
        };

        window.logout = () => {
            authenticated = false;
            currentPin = '';
            document.getElementById('app').style.display = 'none';
            document.getElementById('app').innerHTML = '';
            showPin();
        };

        showPin();
    </script>
</body>
</html>
